(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const g="https://v2.api.noroff.dev",w="ec494b0e-b2de-481e-8429-6727379c72ae",p="token",f="username";function y(a){localStorage.setItem(p,a)}function S(){return localStorage.getItem(p)}function $(a){localStorage.setItem(f,a)}function i(){return localStorage.getItem(f)}function o(a,t){const e=document.createElement("div");e.classList.add("message",t);const s=document.createElement("i");t==="success"?s.classList.add("fa-solid","fa-circle-check"):t==="error"&&s.classList.add("fa-solid","fa-circle-exclamation");const r=document.createElement("p");r.textContent=a,e.append(s,r),document.body.appendChild(e),setTimeout(()=>{e.classList.add("show")},100),setTimeout(()=>{e.classList.add("hide"),setTimeout(()=>{e.remove()},500)},2e3)}function c(a){if(a.querySelector(".spinner"))return;const t=document.createElement("div");t.classList.add("spinner"),a.append(t)}function l(a){const t=a.querySelector(".spinner");t&&t.remove()}class B{constructor(t=`${g}`){this.apiBase=t}utils={setupHeaders:({auth:t=!0,apiKey:e=!0,json:s=!0}={})=>{const r={};return s&&(r["Content-Type"]="application/json"),t&&(r.Authorization=`Bearer ${S()}`),e&&(r["X-Noroff-API-Key"]=`${w}`),r},handleResponse:async t=>{if(!t.ok){const s=(await t.json())?.errors?.[0]?.message||"Unknown error occured!";throw o(s,"error"),new Error(s)}return t.json()},redirectAfterTimeout:(t,e)=>{setTimeout(()=>{window.location.href=t},e)}};auth={login:async({email:t,password:e})=>{try{const s=await fetch(`${this.apiBase}/auth/login`,{headers:this.utils.setupHeaders({auth:!1,apiKey:!1}),method:"POST",body:JSON.stringify({email:t,password:e})});if(!t||!e){o("Email and password are required","error");return}const{data:r}=await this.utils.handleResponse(s);return y(r.accessToken),$(r.name),o("Login success!","success"),this.utils.redirectAfterTimeout("/posts/feed.html",2e3),r}catch(s){o(s.message||"Something went wrong","error")}},register:async({name:t,email:e,password:s})=>{try{const r=await fetch(`${this.apiBase}/auth/register`,{headers:this.utils.setupHeaders({auth:!1,apiKey:!1}),method:"POST",body:JSON.stringify({name:t,email:e,password:s})});if(!t||!e||!s){o("Username, email and password are required","error");return}const{data:n}=await this.utils.handleResponse(r);return o("Register success!","success"),this.utils.redirectAfterTimeout("/auth/login.html",2e3),n}catch(r){o(r.message||"Something went wrong","error")}},logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("username")}};allPosts={viewAll:async t=>{try{c(t);const e=await fetch(`${this.apiBase}/social/posts?_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:s}=await this.utils.handleResponse(e);return s}catch(e){o(e.message||"Something went wrong","error")}finally{l(t)}},viewFollowing:async t=>{try{c(t);const e=await fetch(`${this.apiBase}/social/posts/following?_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:s}=await this.utils.handleResponse(e);return s}catch(e){o(e.message||"Something went wrong","error")}finally{l(t)}},viewOwn:async t=>{const e=i();try{c(t);const s=await fetch(`${this.apiBase}/social/profiles/${e}/posts?_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:r}=await this.utils.handleResponse(s);return r}catch(s){o(s.message||"Something went wrong","error")}finally{l(t)}},search:async t=>{try{const e=await fetch(`${this.apiBase}/social/posts/search?q=${encodeURIComponent(t)}&_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:s}=await this.utils.handleResponse(e);return s}catch(e){o(e.message||"Something went wrong","error")}}};post={view:async t=>{try{const e=await fetch(`${this.apiBase}/social/posts/${t}?_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:s}=await this.utils.handleResponse(e);return s}catch(e){o(e.message||"Something went wrong","error")}},create:async t=>{try{const e=await fetch(`${this.apiBase}/social/posts`,{headers:this.utils.setupHeaders(),method:"POST",body:JSON.stringify(t)}),{data:s}=await this.utils.handleResponse(e);return o("Post created successfully!","success"),this.utils.redirectAfterTimeout("/posts/feed.html",2e3),s}catch(e){o(e.message||"Something went wrong","error")}},delete:async t=>{try{if((await fetch(`${this.apiBase}/social/posts/${t}`,{headers:this.utils.setupHeaders({json:!1}),method:"DELETE"})).ok){o("Post deleted successfully!","success");const s=i();this.utils.redirectAfterTimeout(`/profile/index.html?user=${encodeURIComponent(s)}`,2e3);return}throw o(`Failed to delete post with id ${t}`,"error"),new Error(`Failed to delete post with id ${t}`)}catch(e){o(e.message||"Something went wrong","error")}},update:async(t,e)=>{try{const s=await fetch(`${this.apiBase}/social/posts/${e}`,{headers:this.utils.setupHeaders(),method:"PUT",body:JSON.stringify(t)}),{data:r}=await this.utils.handleResponse(s);o("Post updated successfully!","success");const n=i();return this.utils.redirectAfterTimeout(`/profile/index.html?user=${encodeURIComponent(n)}`,2e3),r}catch(s){o(s.message||"Something went wrong","error")}}};profile={view:async(t,e=null)=>{try{e&&c(e);const s=await fetch(`${this.apiBase}/social/profiles/${t}?_followers=true&_following=true&_posts=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:r}=await this.utils.handleResponse(s);return r}catch(s){o(s.message||"Something went wrong","error")}finally{e&&l(e)}},update:async t=>{const e=i();try{const s=await fetch(`${this.apiBase}/social/profiles/${e}`,{headers:this.utils.setupHeaders(),method:"PUT",body:JSON.stringify(t)}),{data:r}=await this.utils.handleResponse(s);o("Profile updated successfully!","success");const n=i();return this.utils.redirectAfterTimeout(`/profile/index.html?user=${encodeURIComponent(n)}`,2e3),r}catch(s){o(s.message||"Something went wrong","error")}},follow:async t=>{try{const e=await fetch(`${this.apiBase}/social/profiles/${t}/follow`,{headers:this.utils.setupHeaders(),method:"PUT"}),{data:s}=await this.utils.handleResponse(e);return o(`You are now following: ${t}`,"success"),s}catch(e){o(e.message||"Something went wrong","error")}},unfollow:async t=>{try{const e=await fetch(`${this.apiBase}/social/profiles/${t}/unfollow`,{headers:this.utils.setupHeaders(),method:"PUT"}),{data:s}=await this.utils.handleResponse(e);return o(`You have unfollowed: ${t}`,"success"),s}catch(e){o(e.message||"Something went wrong","error")}}}}const m=new B;async function E(a=window.location.pathname){const t=document.getElementById("header-btns");switch(a){case"/":case"/index.html":case"/auth/register.html":d("/"),h("Login","/auth/login.html");break;case"/auth/login.html":d("/"),h("Register","/auth/register.html");break;case"/posts/feed.html":case"/posts/create.html":case"/posts/edit.html":case"/profile/index.html":case"/profile/edit.html":d("/posts/feed.html");const e=h("Logout","/","secondary-border");t.prepend(await v()),e.addEventListener("click",()=>m.auth.logout());break}}function d(a){const t=document.getElementById("logo");t.style.cursor="pointer",t.addEventListener("click",()=>{window.location.pathname=a})}function h(a,t,e="primary-filled"){const s=document.getElementById("header-btns");if(!s)return;const r=document.createElement("a");return r.classList.add("btn",e),r.textContent=a,r.href=t,s.append(r),r}async function v(){const a=document.createElement("img");a.classList.add("profile-btn");const t=i(),e=await m.profile.view(t);return a.src=e.avatar.url,a.alt=e.avatar.alt||`${e.name}'s avatar image`,a.style.cursor="pointer",a.addEventListener("click",()=>{window.location.href=`/profile/index.html?user=${encodeURIComponent(e.name)}`}),a}E();export{B as N,S as a,i as g,o as s};
