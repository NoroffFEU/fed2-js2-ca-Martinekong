(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const g="https://v2.api.noroff.dev",w="ec494b0e-b2de-481e-8429-6727379c72ae",p="token",f="username";function y(a){localStorage.setItem(p,a)}function S(){return localStorage.getItem(p)}function $(a){localStorage.setItem(f,a)}function i(){return localStorage.getItem(f)}function o(a,e){const t=document.createElement("div");t.classList.add("message",e);const s=document.createElement("i");e==="success"?s.classList.add("fa-solid","fa-circle-check"):e==="error"&&s.classList.add("fa-solid","fa-circle-exclamation");const r=document.createElement("p");r.textContent=a,t.append(s,r),document.body.appendChild(t),setTimeout(()=>{t.classList.add("show")},100),setTimeout(()=>{t.classList.add("hide"),setTimeout(()=>{t.remove()},500)},2e3)}function c(a){if(a.querySelector(".spinner"))return;const e=document.createElement("div");e.classList.add("spinner"),a.append(e)}function l(a){const e=a.querySelector(".spinner");e&&e.remove()}class B{constructor(e=`${g}`){this.apiBase=e}utils={setupHeaders:({auth:e=!0,apiKey:t=!0,json:s=!0}={})=>{const r={};return s&&(r["Content-Type"]="application/json"),e&&(r.Authorization=`Bearer ${S()}`),t&&(r["X-Noroff-API-Key"]=`${w}`),r},handleResponse:async e=>{if(!e.ok){const s=(await e.json())?.errors?.[0]?.message||"Unknown error occured!";throw o(s,"error"),new Error(s)}return e.json()},redirectAfterTimeout:(e,t)=>{setTimeout(()=>{window.location.href=e},t)}};auth={login:async({email:e,password:t})=>{try{const s=await fetch(`${this.apiBase}/auth/login`,{headers:this.utils.setupHeaders({auth:!1,apiKey:!1}),method:"POST",body:JSON.stringify({email:e,password:t})});if(!e||!t){o("Email and password are required","error");return}const{data:r}=await this.utils.handleResponse(s);return y(r.accessToken),$(r.name),o("Login success!","success"),this.utils.redirectAfterTimeout("./../posts/feed.html",2e3),r}catch(s){o(s.message||"Something went wrong","error")}},register:async({name:e,email:t,password:s})=>{try{const r=await fetch(`${this.apiBase}/auth/register`,{headers:this.utils.setupHeaders({auth:!1,apiKey:!1}),method:"POST",body:JSON.stringify({name:e,email:t,password:s})});if(!e||!t||!s){o("Username, email and password are required","error");return}const{data:n}=await this.utils.handleResponse(r);return o("Register success!","success"),this.utils.redirectAfterTimeout("./login.html",2e3),n}catch(r){o(r.message||"Something went wrong","error")}},logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("username")}};allPosts={viewAll:async e=>{try{c(e);const t=await fetch(`${this.apiBase}/social/posts?_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:s}=await this.utils.handleResponse(t);return s}catch(t){o(t.message||"Something went wrong","error")}finally{l(e)}},viewFollowing:async e=>{try{c(e);const t=await fetch(`${this.apiBase}/social/posts/following?_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:s}=await this.utils.handleResponse(t);return s}catch(t){o(t.message||"Something went wrong","error")}finally{l(e)}},viewOwn:async e=>{const t=i();try{c(e);const s=await fetch(`${this.apiBase}/social/profiles/${t}/posts?_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:r}=await this.utils.handleResponse(s);return r}catch(s){o(s.message||"Something went wrong","error")}finally{l(e)}},search:async e=>{try{const t=await fetch(`${this.apiBase}/social/posts/search?q=${encodeURIComponent(e)}&_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:s}=await this.utils.handleResponse(t);return s}catch(t){o(t.message||"Something went wrong","error")}}};post={view:async e=>{try{const t=await fetch(`${this.apiBase}/social/posts/${e}?_author=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:s}=await this.utils.handleResponse(t);return s}catch(t){o(t.message||"Something went wrong","error")}},create:async e=>{try{const t=await fetch(`${this.apiBase}/social/posts`,{headers:this.utils.setupHeaders(),method:"POST",body:JSON.stringify(e)}),{data:s}=await this.utils.handleResponse(t);return o("Post created successfully!","success"),this.utils.redirectAfterTimeout("./feed.html",2e3),s}catch(t){o(t.message||"Something went wrong","error")}},delete:async e=>{try{if((await fetch(`${this.apiBase}/social/posts/${e}`,{headers:this.utils.setupHeaders({json:!1}),method:"DELETE"})).ok){o("Post deleted successfully!","success");const s=i();this.utils.redirectAfterTimeout(`./../profile/index.html?user=${encodeURIComponent(s)}`,2e3);return}throw o(`Failed to delete post with id ${e}`,"error"),new Error(`Failed to delete post with id ${e}`)}catch(t){o(t.message||"Something went wrong","error")}},update:async(e,t)=>{try{const s=await fetch(`${this.apiBase}/social/posts/${t}`,{headers:this.utils.setupHeaders(),method:"PUT",body:JSON.stringify(e)}),{data:r}=await this.utils.handleResponse(s);o("Post updated successfully!","success");const n=i();return this.utils.redirectAfterTimeout(`./../profile/index.html?user=${encodeURIComponent(n)}`,2e3),r}catch(s){o(s.message||"Something went wrong","error")}}};profile={view:async(e,t=null)=>{try{t&&c(t);const s=await fetch(`${this.apiBase}/social/profiles/${e}?_followers=true&_following=true&_posts=true`,{headers:this.utils.setupHeaders({json:!1})}),{data:r}=await this.utils.handleResponse(s);return r}catch(s){o(s.message||"Something went wrong","error")}finally{t&&l(t)}},update:async e=>{const t=i();try{const s=await fetch(`${this.apiBase}/social/profiles/${t}`,{headers:this.utils.setupHeaders(),method:"PUT",body:JSON.stringify(e)}),{data:r}=await this.utils.handleResponse(s);o("Profile updated successfully!","success");const n=i();return this.utils.redirectAfterTimeout(`./index.html?user=${encodeURIComponent(n)}`,2e3),r}catch(s){o(s.message||"Something went wrong","error")}},follow:async e=>{try{const t=await fetch(`${this.apiBase}/social/profiles/${e}/follow`,{headers:this.utils.setupHeaders(),method:"PUT"}),{data:s}=await this.utils.handleResponse(t);return o(`You are now following: ${e}`,"success"),s}catch(t){o(t.message||"Something went wrong","error")}},unfollow:async e=>{try{const t=await fetch(`${this.apiBase}/social/profiles/${e}/unfollow`,{headers:this.utils.setupHeaders(),method:"PUT"}),{data:s}=await this.utils.handleResponse(t);return o(`You have unfollowed: ${e}`,"success"),s}catch(t){o(t.message||"Something went wrong","error")}}}}const m=new B;async function E(a=window.location.pathname){const e=document.getElementById("header-btns");if(!e)return;switch(a.replace("/fed2-js2-ca-Martinekong","")){case"/":case"/index.html":u("./"),d("Login","./auth/login.html");break;case"/auth/register.html":u("./../"),d("Login","./login.html");break;case"/auth/login.html":u("./../"),d("Register","./register.html");break;case"/posts/feed.html":case"/posts/create.html":case"/posts/edit.html":case"/profile/index.html":case"/profile/edit.html":u("./../posts/feed.html");const s=d("Logout","./../","secondary-border");e.prepend(await v()),s.addEventListener("click",()=>m.auth.logout());break}}function u(a){const e=document.getElementById("logo");e.style.cursor="pointer",e.addEventListener("click",()=>{window.location.href=a})}function d(a,e,t="primary-filled"){const s=document.getElementById("header-btns");if(!s)return;const r=document.createElement("a");return r.classList.add("btn",t),r.textContent=a,r.href=e,s.append(r),r}async function v(){const a=document.createElement("img");a.classList.add("profile-btn");const e=i(),t=await m.profile.view(e);return a.src=t.avatar.url,a.alt=t.avatar.alt||`${t.name}'s avatar image`,a.style.cursor="pointer",a.addEventListener("click",()=>{window.location.href=`./../profile/index.html?user=${encodeURIComponent(t.name)}`}),a}E();export{B as N,S as a,i as g,o as s};
